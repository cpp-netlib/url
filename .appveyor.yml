image:
 - Visual Studio 2017
 - Visual Studio 2019

platform:
  - x64

configuration:
  - Debug
  - Release

environment:
  matrix:
    - SHARED_LIB: OFF

install:
  - cd C:\Tools\vcpkg
  - git pull
  - .\bootstrap-vcpkg.bat
  - vcpkg install tl-expected catch2 nlohmann-json fmt --triplet x64-windows
  - vcpkg integrate install
  - cd %APPVEYOR_BUILD_FOLDER%

build_script:
  - git submodule init
  - git submodule update
  - mkdir build
  - cd build
  - cmake -B . -A x64 -DCMAKE_TOOLCHAIN_FILE=C:\Tools\vcpkg\scripts\buildsystems\vcpkg.cmake -DBUILD_SHARED_LIBS=%SHARED_LIB% ..
  - cmake --build .
  - ctest

cache: c:\Tools\vcpkg\installed\

matrix:
  fast_finish: true

on_failure:
 - type Testing\Temporary\LastTest.log
